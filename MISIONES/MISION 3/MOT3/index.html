<!DOCTYPE html>
<!--Created by Ardora - www.webardora.net-->
<!--ArdoraLibro-->
<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8">
<html lang="es">
<script src="js/jquery.js" type="text/javascript"></script>
<script src="js/jquery-ui-1.8.16.custom.js" type="text/javascript"></script>
<script src="booklet/jquery.easing.1.3.js" type="text/javascript"></script>
<script src="booklet/jquery.booklet.js" type="text/javascript"></script>
<script src="js/ardoraBooklet.js" type="text/javascript"></script>
<link href="css/ardoraBooklet.css" type="text/css" rel="stylesheet" media="screen">
<title></title></head>
<body>
    <script>
    let userName = "";
    let hasShownRedirect = false;

    function getUserName() {
       const params = new URLSearchParams(window.location.search);
      userName = localStorage.getItem('mision1_respuesta') || localStorage.getItem('nombre_jugador') || params.get("nombre") || localStorage.getItem('nombreMision3');
      if (!userName || userName.toLowerCase() === 'usuario' || userName.toLowerCase() === 'comandante' || userName.toLowerCase() === 'null') {
         userName = prompt("Por favor, ingresa tu nombre para continuar la misión:");
         if (userName && userName.trim() !== "") {
            localStorage.setItem('mision1_respuesta', userName);
         } else {
            userName = "Comandante";
         }
      }
      // Si el nombre vino por URL, también lo guardamos
      if (params.get("nombre") && params.get("nombre") !== "Comandante") {
         localStorage.setItem('mision1_respuesta', userName);
      }
    }

    function detectLastPage() {
       const lastPage = document.getElementById('pag12');
       const penultimatePage = document.getElementById('pag11');
       if (lastPage && penultimatePage) {
          const lastPageVisible = lastPage.closest('.b-page') && window.getComputedStyle(lastPage.closest('.b-page')).display !== 'none';
          const penultimatePageVisible = penultimatePage.closest('.b-page') && window.getComputedStyle(penultimatePage.closest('.b-page')).display !== 'none';
          if ((lastPageVisible || penultimatePageVisible) && !hasShownRedirect) {
             const isOnFinalSpread = document.querySelector('.b-p1 #pag11') || 
                                                 document.querySelector('.b-p2 #pag12') ||
                                                 document.querySelector('.b-p1 #pag12');
             if (isOnFinalSpread) {
                hasShownRedirect = true;
                setTimeout(showRedirectModal, 2000);
             }
          }
       }
    }

    function setupBookletEvents() {
       $('#mybook').on('bookletchange', function(event, data) {
          const currentIndex = data.index;
          const totalPages = $('#mybook').booklet('option', 'pageTotal');
          if (currentIndex >= totalPages - 4 && !hasShownRedirect) {
             hasShownRedirect = true;
             setTimeout(showRedirectModal, 1500);
          }
       });
    }

    function showRedirectModal() {
       let modal = document.getElementById("redirect-modal");
       if (!modal) {
          modal = document.createElement('div');
          modal.id = "redirect-modal";
          modal.style = "display: flex; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.95); z-index: 10000; justify-content: center; align-items: center; flex-direction: column;";
          modal.innerHTML = `<div style='background: linear-gradient(135deg, #1e3c72, #2a5298); padding: 40px; border-radius: 20px; text-align: center; max-width: 500px; border: 2px solid #4a90e2; box-shadow: 0 0 30px rgba(74, 144, 226, 0.5);'><h2 style='color: #ffffff; font-family: Segoe UI, Arial, sans-serif; font-size: 1.8em; margin-bottom: 20px; text-shadow: 0 0 4px #4a90e2;'>Manual Completado</h2><p style='color: #ffffff; font-family: Segoe UI, Arial, sans-serif; font-size: 1.2em; margin-bottom: 25px; line-height: 1.6;'>¡Felicitaciones! Has terminado de leer el manual.</p><p style='color: #6bb6ff; font-family: Segoe UI, Arial, sans-serif; font-size: 1.1em; margin-bottom: 30px;'>Serás redireccionado a la misión 3.</p></div>`;
          document.body.appendChild(modal);
       } else {
          modal.style.display = "flex";
       }
    }

    function redirectToMision3() {
       const params = new URLSearchParams(window.location.search);
       const nombreUrl = params.get('nombre');
       const nombreFinal = nombreUrl || localStorage.getItem('nombreMision3') || userName;
      window.location.href = "../Misión 3f.html?nombre=" + encodeURIComponent(nombreFinal);
    }

    function autoRedirectToMision3() {
       setTimeout(() => {
          document.getElementById("redirect-modal").style.display = "none";
          redirectToMision3();
       }, 2500);
    }

    let originalShowRedirectModal;
    document.addEventListener('DOMContentLoaded', function() {
       getUserName();
       setTimeout(() => {
          setupBookletEvents();
          setInterval(detectLastPage, 2000);
       }, 1000);
       originalShowRedirectModal = showRedirectModal;
       showRedirectModal = function() {
          originalShowRedirectModal();
          autoRedirectToMision3();
       };
    });
    </script>

    <article>
         <div id="mybook">
<div class="cover">
   <h3>Manual Técnico de la Misión 3</h3>
    <div class="imaCenter"> <img alt="Manual Técnico" src="ima/Portada.png"></div>
   <h4>Consulta aquí procedimientos, controles y ayuda técnica para la misión.</h4>
</div>
<div class="pLeft" id="pag0">
<p style="text-align:justify;">Esta sección está reservada para instrucciones técnicas, tips o procedimientos específicos de la misión.<br><br>Utiliza las siguientes páginas para consultar información técnica relevante.</p>
</div>
<div class="pRight" id="pag1">
<p style="text-align:justify;">

</p>
</div>
<div class="pLeft" id="pag2">
<p style="text-align:justify;">

</p>
</div>
<div class="pRight" id="pag3">
<p style="text-align:justify;">

</p>
</div>
<div class="pLeft" id="pag4">
<p style="text-align:justify;">

</p>
</div>
<div class="pRight" id="pag5">
<p style="text-align:justify;">

</p>
</div>
<div class="pLeft" id="pag6">
<p style="text-align:justify;">

</p>
</div>
<div class="pRight" id="pag7">
<p style="text-align:justify;">

</p>
</div>
<div class="pLeft" id="pag8">
<p style="text-align:justify;">

</p>
</div>
<div class="pRight" id="pag9">
<p style="text-align:justify;">

</p>
</div>
<div class="pLeft" id="pag10">
<p style="text-align:justify;">

</p>
</div>
<div class="pRight" id="pag11">
<p style="text-align:justify;">

</p>
</div>
<div class="pLeft" id="pag12">
<p style="text-align:justify;">

</p>
</div>
<div class="pRight">
</div>
      </div>
   </article>
</body></html>
